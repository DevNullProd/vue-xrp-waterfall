!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t["vue-xrp-waterfall"]=e()}(this,function(){"use strict";var t={methods:{color_for:function(t){var e="#3498db";return"payment"==t?e="#0F0":"offer_create"==t?e="#269bae":"offer_cancel"==t?e="#F00":"trust_set"==t?e="#e59866":"escrow_create"==t?e="#aea226":"escrow_finish"==t?e="#f9ff33":"account_set"==t&&(e="#633974"),e}}},e={methods:{convert_type:function(t){return t.split(/(?=[A-Z])/).join("_").toLowerCase()}}},s={name:"Canvas",mixins:[t,e],props:{settings:Object},data:function(){return{width:0,height:0,color_queue:[],color_map:[],columns:[],speeds:[],timer:null,disabled:!1}},computed:{speed:function(){return this.settings.canvas_speed},clear_opacity:function(){return this.settings.canvas_clear_opacity},num_columns:function(){return this.settings.canvas_columns},column_size:function(){return this.width/this.num_columns},context:function(){return this.$refs.xrp_waterfall_canvas.getContext("2d")}},watch:{num_columns:function(){this.reset(),this.resize()}},methods:{resize:function(){this.width=this.$parent.$refs.xrp_waterfall.clientWidth,this.height=this.$parent.$refs.xrp_waterfall.clientHeight,this.context.translate(this.width,0),this.context.scale(-1,1)},reset:function(){if(this.columns.length<this.num_columns)for(var t=this.columns.length;t<this.num_columns;t++)this.color_map[t]=null,this.columns[t]=1,this.speeds[t]=0;this.color_queue=[],this.columns.map(function(t,e){this.columns[e]=0,this.speeds[e]=0,this.color_map[e]=null}.bind(this)),this.timer&&clearInterval(this.timer),this.timer=setInterval(this.step,this.speed)},toggle:function(){this.disabled=!this.disabled},step:function(){this.context.fillStyle="rgba(0,0,0,"+this.clear_opacity+")",this.context.fillRect(0,0,this.width,this.height);for(var t=0;t<this.num_columns;t++)if(null!=this.color_map[t]){var e=this.color_map[t];this.context.fillStyle=e;var s=t*this.column_size,n=this.columns[t],i=this.speeds[t],r=String.fromCharCode(12448+80*Math.random());this.context.fillText(r,s,n),n>756+5e3*Math.random()?(this.columns[t]=1,this.color_map[t]=null):this.columns[t]=n+i}for(t=0;t<this.color_queue.length;++t){for(var a=[],o=0;o<this.color_map.length;o++)null==this.color_map[o]&&a.push(o);if(0==a.length)break;s=a[Math.floor(Math.random()*a.length)];this.color_map[s]=this.color_queue.shift(),this.speeds[s]=15*Math.random()+3}},on_tx:function(t){var e=this.convert_type(t.transaction.TransactionType),s=this.color_for(e);!this.hidden&&this.color_queue.length<250&&this.color_queue.push(s)}},mounted:function(){setTimeout(function(){this.resize()}.bind(this),250),window.addEventListener("resize",this.resize),document.addEventListener("visibilitychange",this.toggle),this.reset()},beforeDestroy:function(){window.removeEventListener("resize",this.resize),document.removeEventListener("visibilitychange",this.toggle)}};function n(t,e,s,n,i,r,a,o,l,c){"boolean"!=typeof a&&(l=o,o=a,a=!1);const _="function"==typeof s?s.options:s;let u;if(t&&t.render&&(_.render=t.render,_.staticRenderFns=t.staticRenderFns,_._compiled=!0,i&&(_.functional=!0)),n&&(_._scopeId=n),r?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(r)},_._ssrRegister=u):e&&(u=a?function(t){e.call(this,c(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,o(t))}),u)if(_.functional){const t=_.render;_.render=function(e,s){return u.call(s),t(e,s)}}else{const t=_.beforeCreate;_.beforeCreate=t?[].concat(t,u):[u]}return s}"undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());const i=n({render:function(){var t=this.$createElement;return(this._self._c||t)("canvas",{ref:"xrp_waterfall_canvas",attrs:{id:"xrp_waterfall_canvas",height:this.height,width:this.width}})},staticRenderFns:[]},void 0,s,void 0,!1,void 0,!1,void 0,void 0,void 0);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=7,o=-500;function l(){for(var t=new Array,e=0;e<a;e+=1)t.push({tx:null,hash:null,text:null,url:null,pos:o});return t}const c=n({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"xrp_waterfall_marquee"},on:{mouseover:function(e){return t.on_hover()},mouseleave:function(e){return t.on_unhover()}}},t._l(t.items.length,function(e){return s("div",{ref:"xrp_waterfall_marquee_item_"+(e-1),refInFor:!0,staticClass:"xrp_waterfall_marquee_item",style:{transform:"translateX("+t.items[e-1].pos+"px)"}},[s("a",{attrs:{href:t.items[e-1].url}},[t._v(t._s(t.items[e-1].text))])])}),0)},staticRenderFns:[]},void 0,{name:"Marquee",mixins:[{methods:{round:function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},format_account:function(t){return t.substring(0,7)+"..."},format_amount:function(t){return"object"===r(t)?this.round(parseFloat(t.value),3)+" "+t.currency+" ("+this.format_account(t.issuer)+")":this.round(parseInt(t)/1e6,3)+" XRP"},text_for:function(t,e){var s=t.transaction;return"payment"==e?this.format_account(s.Account)+" -> "+this.format_amount(s.Amount)+" -> "+this.format_account(s.Destination):"offer_create"==e?this.format_amount(s.TakerGets)+" / "+this.format_amount(s.TakerPays):"trust_set"==e?this.format_account(s.Account)+" Extended Trust To "+this.format_account(s.LimitAmount.issuer):null}}},e],props:{settings:Object},data:function(){return{width:0,items:l(),current:0,id:0,pause:!1,timer:null}},computed:{enabled:function(){return this.$props.settings.marquee_enabled}},watch:{enabled:function(){this.reset()}},methods:{reset:function(){this.width=this.$parent.$refs.xrp_waterfall.clientWidth;for(var t=0;t<this.items.length;t+=1)this.items[t].pos=o},on_hover:function(){this.pause=!0},on_unhover:function(){this.pause=!1},on_tx:function(t){if(!this.pause&&this.enabled&&!(this.items[this.current].pos>o)){var e=this.convert_type(t.transaction.TransactionType),s=this.text_for(t,e);if(s){var n=(0==this.current?a:this.current)-1,i=this.$refs["xrp_waterfall_marquee_item_"+n][0];if(!(parseInt(i.style.transform.replace("translateX(","").replace("px)",""))+i.clientWidth>this.width-25)){var r=t.transaction.hash,l=this.items[this.current];l.tx=t,l.hash=r,l.text=s,l.url="https://xrp1ntel.com/tx/"+r,l.pos=this.width,this.current+=1,this.current>=this.items.length&&(this.current=0)}}}}},mounted:function(){window.addEventListener("resize",this.reset),this.reset(),this.timer=setInterval(function(){if(!this.pause)for(var t=0;t<this.items.length;t+=1)this.items[t].pos-=5}.bind(this),50)},beforeDestroy:function(){window.removeEventListener("resize",this.reset),this.timer&&clearInterval(this.timer)}},"data-v-1c12bacd",!1,void 0,!1,void 0,void 0,void 0);const _=n({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{attrs:{id:"xrp_waterfall_tx_tallies"}},[s("li",{style:{color:t.color_for("payment")}},[t._v("\n    Payment\n    "),s("span",{staticClass:"tx_tally"},[t._v(t._s(t.tallies.payment))]),t._v(" "),s("div",{staticClass:"tx_tally_after"})]),t._v(" "),s("li",{style:{color:t.color_for("offer_create")}},[t._v("\n    OfferCreate\n    "),s("span",{staticClass:"tx_tally"},[t._v(t._s(t.tallies.offer_create))]),t._v(" "),s("div",{staticClass:"tx_tally_after"})]),t._v(" "),s("li",{style:{color:t.color_for("offer_cancel")}},[t._v("\n    OfferCancel\n    "),s("span",{staticClass:"tx_tally"},[t._v(t._s(t.tallies.offer_cancel))]),t._v(" "),s("div",{staticClass:"tx_tally_after"})]),t._v(" "),s("li",{style:{color:t.color_for("trust_set")}},[t._v("\n    TrustSet\n    "),s("span",{staticClass:"tx_tally"},[t._v(t._s(t.tallies.trust_set))]),t._v(" "),s("div",{staticClass:"tx_tally_after"})]),t._v(" "),s("li",{style:{color:t.color_for("escrow_create")}},[t._v("\n    EscrowCreate\n    "),s("span",{staticClass:"tx_tally"},[t._v(t._s(t.tallies.escrow_create))]),t._v(" "),s("div",{staticClass:"tx_tally_after"})]),t._v(" "),s("li",{style:{color:t.color_for("escrow_finish")}},[t._v("\n    EscrowFinish\n    "),s("span",{staticClass:"tx_tally"},[t._v(t._s(t.tallies.escrow_finish))]),t._v(" "),s("div",{staticClass:"tx_tally_after"})]),t._v(" "),s("li",{style:{color:t.color_for("account_set")}},[t._v("\n    AccountSet\n    "),s("span",{staticClass:"tx_tally"},[t._v(t._s(t.tallies.account_set))]),t._v(" "),s("div",{staticClass:"tx_tally_after"})])])},staticRenderFns:[]},void 0,{name:"TxTallies",mixins:[t,e],data:function(){return{tallies:{payment:0,offer_create:0,offer_cancel:0,trust_set:0,escrow_create:0,escrow_finish:0,account_set:0}}},methods:{on_tx:function(t){var e=this.convert_type(t.transaction.TransactionType);this.tallies[e]+=1}}},"data-v-d0fe4c20",!1,void 0,!1,void 0,void 0,void 0);const u=n({render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",{staticClass:"slider",attrs:{type:"range"},domProps:{value:t.value},on:{input:function(e){return t.$emit("input",e.target.value)}}})},staticRenderFns:[]},void 0,{name:"Slider",props:{value:Number}},"data-v-fcdbf3d0",!1,void 0,!1,void 0,void 0,void 0);const h=n({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{style:{right:t.toggle_pos+"px"},attrs:{id:"xrp_waterfall_settings_toggle"},on:{click:t.toggle}},[t._v("\n    âš™\n  ")]),t._v(" "),s("div",{style:{right:t.settings_pos+"px"},attrs:{id:"xrp_waterfall_settings"}},[t._m(0),t._v(" "),s("p",[t._v("\n      Each transaction on the live XRP network is\n      rendered in color here.\n    ")]),t._v(" "),t._m(1),t._v(" "),s("TxTallies",{ref:"tallies"}),t._v(" "),t._m(2),t._v(" "),s("Slider",{model:{value:t.speed,callback:function(e){t.speed=e},expression:"speed"}}),t._v(" "),t._m(3),t._v(" "),s("Slider",{model:{value:t.columns,callback:function(e){t.columns=e},expression:"columns"}}),t._v(" "),t._m(4),t._v(" "),s("Slider",{model:{value:t.tail,callback:function(e){t.tail=e},expression:"tail"}}),t._v(" "),t._m(5),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.enable_marquee,expression:"enable_marquee"}],attrs:{id:"xrp_waterfall_enable_marquee_toggle",type:"checkbox"},domProps:{checked:Array.isArray(t.enable_marquee)?t._i(t.enable_marquee,null)>-1:t.enable_marquee},on:{change:function(e){var s=t.enable_marquee,n=e.target,i=!!n.checked;if(Array.isArray(s)){var r=t._i(s,null);n.checked?r<0&&(t.enable_marquee=s.concat([null])):r>-1&&(t.enable_marquee=s.slice(0,r).concat(s.slice(r+1)))}else t.enable_marquee=i}}}),t._v(" "),s("div",{staticStyle:{clear:"both"}}),t._v(" "),s("hr"),t._v(" "),t._m(6)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("b",[this._v("XRP Transaction Waterfall")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("b",[this._v("Transaction Types")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("b",[this._v("Speed")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("b",[this._v("Columns")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("b",[this._v("Tail Length")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("b",[this._v("Show Marquee")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"text-align":"center"}},[e("b",[this._v("Tip")]),e("br"),this._v("\n    Press "),e("b",[this._v("<F11>")]),this._v(" for fullscreen"),e("br"),this._v("\n    (makes a great screensaver)\n    ")])}]},void 0,{name:"Settings",components:{TxTallies:_,Slider:u},props:{settings:Object},data:function(){return{toggled:!1,toggle_pos:0,offset:360,base_speed:50,base_columns:50,base_tail:100}},computed:{settings_pos:function(){return this.toggle_pos-this.offset},speed:{get:function(){return this.base_speed},set:function(t){this.base_speed=parseInt(t),this.settings.marquee_speed=15e3-1e3*this.base_speed,this.settings.canvas_speed=75-.5*this.base_speed}},columns:{get:function(){return this.base_columns},set:function(t){this.base_columns=parseInt(t),this.settings.canvas_columns=224*this.base_columns+32}},tail:{get:function(){return this.base_tail},set:function(t){this.base_tail=parseInt(t),this.settings.canvas_clear_opacity=(99-(this.base_tail-1))/90*.45+.05}},enable_marquee:{get:function(){return this.settings.marquee_enabled},set:function(t){this.settings.marquee_enabled=t}}},methods:{toggle:function(){this.toggled=!this.toggled,this.toggle_pos+=(this.toggled?1:-1)*this.offset},on_tx:function(t){this.$refs.tallies.on_tx(t)}}},"data-v-2bca1bb4",!1,void 0,!1,void 0,void 0,void 0);const f=n({render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"xrp_waterfall",attrs:{id:"xrp_waterfall"}},[s("Canvas",{ref:"canvas",attrs:{settings:t.settings}}),t._v(" "),s("Marquee",{ref:"marquee",attrs:{settings:t.settings}}),t._v(" "),s("Settings",{ref:"settings",attrs:{settings:t.settings}}),t._v(" "),t.connecting?s("div",{attrs:{id:"xrp_waterfall_connecting"}},[t._v("\n    Connecting\n  ")]):t._e()],1)},staticRenderFns:[]},void 0,{name:"XRPWaterfall",mixins:[{data:function(){return{ws:null,last_tx_time:new Date,connecting:!0}},methods:{init_ws:function(){this.ws=new WebSocket("wss://s1.ripple.com:443"),this.ws.onopen=function(){var t=JSON.stringify({command:"subscribe",streams:["transactions"]});this.ws.send(t)}.bind(this),this.ws.onmessage=function(t){var e=JSON.parse(t.data);e.transaction&&(this.connecting=!1,this.last_tx_time=new Date,this.on_tx(e))}.bind(this)},check_ws:function(){setInterval(function(){var t=new Date;t-this.last_tx_time>7500&&(this.connecting=!0,this.ws.close(),this.init_ws(),this.last_tx_time=t)}.bind(this),1500)}}}],components:{Canvas:i,Marquee:c,Settings:h},data:function(){return{settings:{canvas_columns:128,canvas_speed:50,canvas_clear_opacity:.05,marquee_speed:1e4,marquee_enabled:!0}}},methods:{on_tx:function(t){this.$refs.canvas.on_tx(t),this.$refs.marquee.on_tx(t),this.$refs.settings.on_tx(t)}},created:function(){this.init_ws(),this.check_ws()}},"data-v-480b1183",!1,void 0,!1,void 0,void 0,void 0);return{install:function(t,e){t.component("XRPWaterfall",f)}}});
//# sourceMappingURL=vue-xrp-waterfall.min.js.map
