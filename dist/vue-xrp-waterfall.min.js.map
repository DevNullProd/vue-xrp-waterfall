{"version":3,"file":"vue-xrp-waterfall.min.js","sources":["../src/mixins/tx_colors.js","../src/mixins/tx_type.js","../node_modules/vue-runtime-helpers/dist/index.mjs","../src/mixins/tx_text.js","../src/components/Marquee.vue","../src/mixins/websocket.js","../src/index.js"],"sourcesContent":["const DEFAULT_COLOR = \"#3498db\";\n\nexport default {\n  methods : {\n    color_for : function(tx_type){\n      var color = DEFAULT_COLOR;\n\n      if(tx_type == 'payment')\n        color = '#0F0';\n      else if(tx_type == 'offer_create')\n        color = '#269bae';\n      else if(tx_type == 'offer_cancel')\n        color = '#F00';\n      else if(tx_type == 'trust_set')\n        color =  '#e59866';\n      else if(tx_type == 'escrow_create')\n        color = '#aea226';\n      else if(tx_type == 'escrow_finish')\n        color = '#f9ff33';\n      else if(tx_type == 'account_set')\n        color = '#633974';\n\n      return color;\n    }\n  }\n}\n","export default {\n  methods : {\n    convert_type : function(tx_type){\n      return tx_type.split(/(?=[A-Z])/)\n                    .join('_')\n                    .toLowerCase();\n    }\n  }\n}\n","function normalizeComponent(template, style, script, scopeId, isFunctionalTemplate, moduleIdentifier /* server only */, shadowMode, createInjector, createInjectorSSR, createInjectorShadow) {\r\n    if (typeof shadowMode !== 'boolean') {\r\n        createInjectorSSR = createInjector;\r\n        createInjector = shadowMode;\r\n        shadowMode = false;\r\n    }\r\n    // Vue.extend constructor export interop.\r\n    const options = typeof script === 'function' ? script.options : script;\r\n    // render functions\r\n    if (template && template.render) {\r\n        options.render = template.render;\r\n        options.staticRenderFns = template.staticRenderFns;\r\n        options._compiled = true;\r\n        // functional template\r\n        if (isFunctionalTemplate) {\r\n            options.functional = true;\r\n        }\r\n    }\r\n    // scopedId\r\n    if (scopeId) {\r\n        options._scopeId = scopeId;\r\n    }\r\n    let hook;\r\n    if (moduleIdentifier) {\r\n        // server build\r\n        hook = function (context) {\r\n            // 2.3 injection\r\n            context =\r\n                context || // cached call\r\n                    (this.$vnode && this.$vnode.ssrContext) || // stateful\r\n                    (this.parent && this.parent.$vnode && this.parent.$vnode.ssrContext); // functional\r\n            // 2.2 with runInNewContext: true\r\n            if (!context && typeof __VUE_SSR_CONTEXT__ !== 'undefined') {\r\n                context = __VUE_SSR_CONTEXT__;\r\n            }\r\n            // inject component styles\r\n            if (style) {\r\n                style.call(this, createInjectorSSR(context));\r\n            }\r\n            // register component module identifier for async chunk inference\r\n            if (context && context._registeredComponents) {\r\n                context._registeredComponents.add(moduleIdentifier);\r\n            }\r\n        };\r\n        // used by ssr in case component is cached and beforeCreate\r\n        // never gets called\r\n        options._ssrRegister = hook;\r\n    }\r\n    else if (style) {\r\n        hook = shadowMode\r\n            ? function (context) {\r\n                style.call(this, createInjectorShadow(context, this.$root.$options.shadowRoot));\r\n            }\r\n            : function (context) {\r\n                style.call(this, createInjector(context));\r\n            };\r\n    }\r\n    if (hook) {\r\n        if (options.functional) {\r\n            // register for functional component in vue file\r\n            const originalRender = options.render;\r\n            options.render = function renderWithStyleInjection(h, context) {\r\n                hook.call(context);\r\n                return originalRender(h, context);\r\n            };\r\n        }\r\n        else {\r\n            // inject component registration as beforeCreate hook\r\n            const existing = options.beforeCreate;\r\n            options.beforeCreate = existing ? [].concat(existing, hook) : [hook];\r\n        }\r\n    }\r\n    return script;\r\n}\n\nconst isOldIE = typeof navigator !== 'undefined' &&\r\n    /msie [6-9]\\\\b/.test(navigator.userAgent.toLowerCase());\r\nfunction createInjector(context) {\r\n    return (id, style) => addStyle(id, style);\r\n}\r\nlet HEAD;\r\nconst styles = {};\r\nfunction addStyle(id, css) {\r\n    const group = isOldIE ? css.media || 'default' : id;\r\n    const style = styles[group] || (styles[group] = { ids: new Set(), styles: [] });\r\n    if (!style.ids.has(id)) {\r\n        style.ids.add(id);\r\n        let code = css.source;\r\n        if (css.map) {\r\n            // https://developer.chrome.com/devtools/docs/javascript-debugging\r\n            // this makes source maps inside style tags work properly in Chrome\r\n            code += '\\n/*# sourceURL=' + css.map.sources[0] + ' */';\r\n            // http://stackoverflow.com/a/26603875\r\n            code +=\r\n                '\\n/*# sourceMappingURL=data:application/json;base64,' +\r\n                    btoa(unescape(encodeURIComponent(JSON.stringify(css.map)))) +\r\n                    ' */';\r\n        }\r\n        if (!style.element) {\r\n            style.element = document.createElement('style');\r\n            style.element.type = 'text/css';\r\n            if (css.media)\r\n                style.element.setAttribute('media', css.media);\r\n            if (HEAD === undefined) {\r\n                HEAD = document.head || document.getElementsByTagName('head')[0];\r\n            }\r\n            HEAD.appendChild(style.element);\r\n        }\r\n        if ('styleSheet' in style.element) {\r\n            style.styles.push(code);\r\n            style.element.styleSheet.cssText = style.styles\r\n                .filter(Boolean)\r\n                .join('\\n');\r\n        }\r\n        else {\r\n            const index = style.ids.size - 1;\r\n            const textNode = document.createTextNode(code);\r\n            const nodes = style.element.childNodes;\r\n            if (nodes[index])\r\n                style.element.removeChild(nodes[index]);\r\n            if (nodes.length)\r\n                style.element.insertBefore(textNode, nodes[index]);\r\n            else\r\n                style.element.appendChild(textNode);\r\n        }\r\n    }\r\n}\n\nfunction createInjectorSSR(context) {\r\n    if (!context && typeof __VUE_SSR_CONTEXT__ !== 'undefined') {\r\n        context = __VUE_SSR_CONTEXT__;\r\n    }\r\n    if (!context)\r\n        return () => { };\r\n    if (!('styles' in context)) {\r\n        context._styles = context._styles || {};\r\n        Object.defineProperty(context, 'styles', {\r\n            enumerable: true,\r\n            get: () => context._renderStyles(context._styles)\r\n        });\r\n        context._renderStyles = context._renderStyles || renderStyles;\r\n    }\r\n    return (id, style) => addStyle$1(id, style, context);\r\n}\r\nfunction addStyle$1(id, css, context) {\r\n    const group = process.env.NODE_ENV === 'production' ? css.media || 'default' : id;\r\n    const style = context._styles[group] || (context._styles[group] = { ids: [], css: '' });\r\n    if (!style.ids.includes(id)) {\r\n        style.media = css.media;\r\n        style.ids.push(id);\r\n        let code = css.source;\r\n        if (process.env.NODE_ENV !== 'production' && css.map) {\r\n            // https://developer.chrome.com/devtools/docs/javascript-debugging\r\n            // this makes source maps inside style tags work properly in Chrome\r\n            code += '\\n/*# sourceURL=' + css.map.sources[0] + ' */';\r\n            // http://stackoverflow.com/a/26603875\r\n            code +=\r\n                '\\n/*# sourceMappingURL=data:application/json;base64,' +\r\n                    Buffer.from(unescape(encodeURIComponent(JSON.stringify(css.map)))).toString('base64') +\r\n                    ' */';\r\n        }\r\n        style.css += code + '\\n';\r\n    }\r\n}\r\nfunction renderStyles(styles) {\r\n    let css = '';\r\n    for (const key in styles) {\r\n        const style = styles[key];\r\n        css +=\r\n            '<style data-vue-ssr-id=\"' +\r\n                Array.from(style.ids).join(' ') +\r\n                '\"' +\r\n                (style.media ? ' media=\"' + style.media + '\"' : '') +\r\n                '>' +\r\n                style.css +\r\n                '</style>';\r\n    }\r\n    return css;\r\n}\n\nfunction createInjector$1(context, shadowRoot) {\r\n    return (id, style) => addStyle$2(style, shadowRoot);\r\n}\r\nfunction createStyleElement(shadowRoot) {\r\n    var styleElement = document.createElement('style');\r\n    styleElement.type = 'text/css';\r\n    shadowRoot.appendChild(styleElement);\r\n    return styleElement;\r\n}\r\nfunction addStyle$2(css, shadowRoot) {\r\n    const styleElement = createStyleElement(shadowRoot);\r\n    if (css.media)\r\n        styleElement.setAttribute('media', css.media);\r\n    if ('styleSheet' in styleElement) {\r\n        styleElement.styleSheet.cssText = css.source;\r\n    }\r\n    else {\r\n        while (styleElement.firstChild) {\r\n            styleElement.removeChild(styleElement.firstChild);\r\n        }\r\n        styleElement.appendChild(document.createTextNode(css.source));\r\n    }\r\n}\n\nexport { normalizeComponent, createInjector, createInjectorSSR, createInjector$1 as createInjectorShadow };\n//# sourceMappingURL=index.mjs.map\n","const DROPS_PER_XRP = 1000000;\n\n// TODO improve formatting, link to accounts, tags\n\nexport default {\n  methods : {\n    round : function(value, decimals){\n      return Math.round(value * Math.pow(10, decimals)) / Math.pow(10, decimals);\n    },\n\n    format_account : function(account){\n      return account.substring(0, 7) + \"...\";\n    },\n\n    format_amount : function(amount){\n      if(typeof(amount) === \"object\")\n        return this.round(parseFloat(amount['value']), 3) + ' ' +\n               amount['currency']          +\n               ' (' + this.format_account(amount['issuer']) + ')';\n\n      else\n        return this.round(parseInt(amount) / DROPS_PER_XRP, 3) + \" XRP\";\n\n    },\n\n    text_for : function(tx, type){\n      var txo = tx['transaction'];\n\n      if(type == 'payment')\n        return this.format_account(txo['Account']) + ' -> ' +\n               this.format_amount(txo['Amount'])   + ' -> ' +\n               this.format_account(txo['Destination']);\n\n      else if(type == 'offer_create')\n        return this.format_amount(txo['TakerGets']) + ' / ' +\n               this.format_amount(txo['TakerPays']);\n\n      else if(type == 'trust_set')\n        return this.format_account(txo['Account']) + ' Extended Trust To ' +\n               this.format_account(txo['LimitAmount']['issuer']);\n\n      // TODO other tx text description\n\n      return null;\n    }\n  }\n}\n","<template>\n  <div id=\"xrp_waterfall_marquee\"\n       v-on:mouseover=\"on_hover()\"\n       v-on:mouseleave=\"on_unhover()\">\n    <div v-for=\"i in items.length\"\n         class=\"xrp_waterfall_marquee_item\"\n         v-bind:ref=\"'xrp_waterfall_marquee_item_' + (i-1)\"\n         v-bind:style=\"{transform : 'translateX(' + items[i-1].pos + 'px)'}\">\n      <a v-bind:href=\"items[i-1].url\">{{items[i-1].text}}</a>\n    </div>\n  </div>\n</template>\n\n<script>\nimport TxText from '../mixins/tx_text'\nimport TxType from '../mixins/tx_type'\n\nconst MAX_ITEMS =    7;\nconst TARGET    = -500;\n\n// TODO color code text according to tx color\n\nfunction create_default(){\n  var items = new Array();\n  for(var i = 0; i < MAX_ITEMS; i+= 1)\n    items.push({tx   : null,\n                hash : null,\n                text : null,\n                url  : null,\n                pos  : TARGET});\n  return items;\n}\n\nexport default {\n  name: 'Marquee',\n\n  mixins : [TxText, TxType],\n\n  props : {\n    settings : Object,\n  },\n\n  data : function(){\n    return {\n      width : 0,\n      items : create_default(),\n      current : 0,\n\n      id     : 0,\n\n      pause  : false,\n      timer  : null\n    };\n  },\n\n  computed : {\n    enabled : function(){\n      return this.$props.settings.marquee_enabled;\n    }\n  },\n\n  watch : {\n    enabled : function(){\n      this.reset();\n    }\n  },\n\n  methods : {\n    reset : function(){\n      this.width   = this.$parent.$refs.xrp_waterfall.clientWidth;\n      for(var i = 0; i < this.items.length; i+= 1)\n        this.items[i].pos = TARGET;\n    },\n\n    on_hover : function(){\n      this.pause = true;\n    },\n\n    on_unhover : function(){\n      this.pause = false;\n    },\n\n    on_tx : function(tx){\n      if(this.pause || !this.enabled) return;\n      if(this.items[this.current].pos > TARGET) return;\n\n      var type = this.convert_type(tx[\"transaction\"]['TransactionType']);\n      var text = this.text_for(tx, type);\n      if(!text) return;\n\n      // ensure previous item is completely revealed\n      var prev = (this.current == 0 ? MAX_ITEMS : this.current) - 1;\n      var prev_item      = this.$refs['xrp_waterfall_marquee_item_' + prev][0];\n      var prev_transform = parseInt(prev_item.style.transform.replace(\"translateX(\", \"\").replace(\"px)\", \"\"));\n      var prev_right     = prev_transform + prev_item.clientWidth;\n\n      // TODO if before we return here, queue up a few txs\n      //      to be added inbetween closed ledgers for\n      //      continuous marquee population (mantain this queue size\n      //      and periodically add to marquee)\n      if(prev_right > (this.width - 25)) return; // also add a little extra padding\n\n      var hash = tx['transaction']['hash'];\n\n      var content = this.items[this.current];\n      content.tx   = tx;\n      content.hash = hash;\n      content.text = text;\n      content.url  = \"https://xrp1ntel.com/tx/\" + hash;\n      content.pos  = this.width;\n\n      this.current += 1;\n      if(this.current >= this.items.length) this.current = 0;\n    }\n  },\n\n  mounted : function(){\n    // recompute dimensions on resize\n    window.addEventListener('resize', this.reset);\n\n    this.reset();\n\n    this.timer = setInterval(function(){\n      if(this.pause) return;\n\n      for(var i = 0; i < this.items.length; i+= 1)\n        this.items[i].pos -= 5;\n    }.bind(this), 50);\n  },\n\n  beforeDestroy : function(){\n    window.removeEventListener('resize', this.reset);\n\n    if(this.timer)\n      clearInterval(this.timer);\n  }\n}\n</script>\n\n<style scoped>\n#xrp_waterfall_marquee {\n  position: absolute;\n  bottom: 0px;\n\n  height:     20px;\n  width:      100%;\n\n  overflow:   hidden;\n  word-break: break-all;\n\n  background: black;\n  color:      white;\n  border:     none;\n\n  cursor: pointer;\n}\n\n#xrp_waterfall_marquee a{\n  color: white;\n  text-decoration: none;\n}\n\n.xrp_waterfall_marquee_item{\n  position: absolute;\n}\n</style>\n","const WS_TIMEOUT = 7500;\n\nmodule.exports = {\n  data : function(){\n    return {\n      ws           : null,\n      last_tx_time : new Date(),\n      connecting   : true\n    }\n  },\n\n  methods : {\n    init_ws : function(){\n      this.ws = new WebSocket(\"wss://s1.ripple.com:443\");\n      this.ws.onopen = function(){\n        var json = JSON.stringify({\n                     'command' : 'subscribe',\n                     'streams' : [\"transactions\"],\n                   });\n        this.ws.send(json);\n      }.bind(this)\n\n      this.ws.onmessage = function (event) {\n        var json = JSON.parse(event.data);\n        if(!json[\"transaction\"]) return;\n\n        this.connecting = false;\n        this.last_tx_time = new Date();\n\n        this.on_tx(json);\n      }.bind(this)\n    },\n\n    check_ws : function(){\n      // periodically check connection\n      setInterval(function(){\n        var now = new Date();\n        if(now - this.last_tx_time > WS_TIMEOUT){\n          this.connecting = true;\n\n          this.ws.close();\n          this.init_ws();\n          this.last_tx_time = now;\n        }\n      }.bind(this), 1500);\n    }\n  }\n}\n","import XRPWaterfall from './xrp-waterfall.vue'\n\nexport default {\n  install : function(vue, opts){\n    vue.component('XRPWaterfall', XRPWaterfall)\n  }\n}\n"],"names":["methods","color_for","tx_type","color","convert_type","split","join","toLowerCase","normalizeComponent","template","style","script","scopeId","isFunctionalTemplate","moduleIdentifier","shadowMode","createInjector","createInjectorSSR","createInjectorShadow","options","hook","render","staticRenderFns","_compiled","functional","_scopeId","context","this","$vnode","ssrContext","parent","__VUE_SSR_CONTEXT__","call","_registeredComponents","add","_ssrRegister","$root","$options","shadowRoot","originalRender","h","existing","beforeCreate","concat","navigator","test","userAgent","round","value","decimals","Math","pow","format_account","account","substring","format_amount","amount","_typeof","parseFloat","parseInt","text_for","tx","type","txo","data","ws","last_tx_time","Date","connecting","init_ws","WebSocket","onopen","json","JSON","stringify","send","bind","onmessage","event","parse","on_tx","check_ws","setInterval","now","close","install","vue","opts","component","XRPWaterfall"],"mappings":"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"}